<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEXUSÂ·IOT â€” Control Smart Home</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='18' fill='%2305080f'/><text y='.9em' font-size='80' x='10'>ğŸ›ï¸</text></svg>">
  <link rel="stylesheet" href="css/estilos.css">
  <link rel="stylesheet" href="css/control.css">
</head>
<body>
<div class="app-wrapper">

  <nav class="top-nav">
    <a class="brand" href="index.html">
      <div class="brand-icon">ğŸ </div>
      <div>NEXUS<span style="color:var(--muted)">Â·</span>IOT<span class="brand-sub">SMART HOME SYSTEM</span></div>
    </a>
    <div class="nav-links">
      <a href="index.html"   class="nav-link-btn active">ğŸ—‚ï¸ Admin</a>
      <a href="control.html" class="nav-link-btn">ğŸ›ï¸ Control</a>
      <a href="monitor.html" class="nav-link-btn">ğŸ“Š Monitor</a>
     </div>
  </nav>

  <main class="main-content">
    <div class="page-header">
      <div class="page-title">Panel de <span>Control</span></div>
      <div class="page-subtitle">// Smart Rack Â· PaqueterÃ­a Segura Â· EnergÃ­a Hogar â€” Refresco 3s</div>
    </div>

    <!-- System tabs -->
    <div class="sys-tabs">
      <div class="sys-tab active-rack" id="tab-rack"   onclick="switchTab('rack')">  <span class="nav-sys-dot dot-rack"></span>ğŸ–¥ï¸ Smart Rack</div>
      <div class="sys-tab"             id="tab-access" onclick="switchTab('access')"><span class="nav-sys-dot dot-access"></span>ğŸ“¦ PaqueterÃ­a</div>
      <div class="sys-tab"             id="tab-energy" onclick="switchTab('energy')"><span class="nav-sys-dot dot-energy"></span>âš¡ EnergÃ­a</div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• PANEL 1: SMART RACK â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="sys-panel active" id="panel-rack">
      <div class="sys-header rack">
        <span class="sys-header-icon">ğŸ–¥ï¸</span>
        <span class="sys-header-title">Smart Rack</span>
        <span class="sys-header-sub">â€” Monitoreo tÃ©rmico Â· Extractores PWM Â· Apagado de emergencia</span>
      </div>

      <div class="rack-metrics">
        <div class="metric-chip"><div class="metric-chip-val" id="rackTemp" style="color:var(--rack)">â€“</div><div class="metric-chip-lbl">Temperatura</div></div>
        <div class="metric-chip"><div class="metric-chip-val" id="rackHumid" style="color:var(--rack)">â€“</div><div class="metric-chip-lbl">Humedad</div></div>
        <div class="metric-chip"><div class="metric-chip-val" id="rackAirflow" style="color:var(--access)">â€“</div><div class="metric-chip-lbl">Flujo Aire</div></div>
      </div>

      <div class="rack-grid">
        <!-- Gauge -->
        <div class="gauge-card">
          <div class="gauge-label" style="margin-bottom:0.8rem">TEMPERATURA DEL RACK</div>
          <div class="gauge-wrap">
            <canvas id="gaugeCanvas" class="gauge-canvas"></canvas>
            <div class="gauge-center">
              <div class="gauge-value" id="gaugeValue" style="color:var(--rack)">â€“</div>
              <div class="gauge-unit">Â°C</div>
            </div>
          </div>
          <div style="display:flex;gap:0.5rem;flex-wrap:wrap;justify-content:center;margin-top:0.5rem">
            <span class="badge normal">âœ… &lt;40Â°C Normal</span>
            <span class="badge warning">âš ï¸ 40-55Â°C Alerta</span>
            <span class="badge critical">ğŸš¨ &gt;55Â°C CrÃ­tico</span>
          </div>
        </div>

        <!-- Fan -->
        <div class="fan-card">
          <div class="gauge-label" style="margin-bottom:0.8rem">EXTRACTOR PWM</div>
          <div class="fan-icon-wrap">
            <div class="fan-icon" id="fanIcon">ğŸŒ€</div>
          </div>
          <div class="fan-speed-bar">
            <div class="speed-label">
              <span>Velocidad actual</span>
              <span id="fanLabel">65%</span>
            </div>
            <div class="speed-track"><div class="speed-fill" id="fanBar" style="width:65%"></div></div>
          </div>
          <div style="margin-top:1rem;display:flex;align-items:center;justify-content:space-between;font-family:var(--font-mono);font-size:0.75rem;color:var(--muted)">
            <span>Relevador EnergÃ­a:</span>
            <span class="badge normal" id="relayBadge">âš¡ ENERGIZADO</span>
          </div>
        </div>
      </div>

      <!-- Emergency panel -->
      <div class="emergency-panel">
        <div class="emergency-title">// CONTROLES DE EMERGENCIA</div>
        <div class="emergency-btns">
          <button class="btn-emergency fan" onclick="fanMax()">ğŸ’¨ Fans al 100%</button>
          <button class="btn-emergency ssh" onclick="triggerSSH()">ğŸ’» SSH Shutdown</button>
          <button class="btn-emergency cut" onclick="cutRelay()">ğŸ”Œ Cortar EnergÃ­a</button>
        </div>
        <div class="shutdown-countdown" id="shutdownPanel">
          <div>ğŸš¨ Apagando servidor en</div>
          <div class="shutdown-timer" id="shutdownTimer">60s</div>
          <button class="btn-cancel-shutdown" onclick="cancelShutdown()">âœ— Cancelar</button>
        </div>
      </div>

      <!-- Log -->
      <div class="action-log">
        <div class="log-title">// LOG RACK</div>
        <div class="log-entries" id="log-rack"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• PANEL 2: PAQUETERÃA â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="sys-panel" id="panel-access">
      <div class="sys-header access">
        <span class="sys-header-icon">ğŸ“¦</span>
        <span class="sys-header-title">PaqueterÃ­a Segura</span>
        <span class="sys-header-sub">â€” CÃ¡mara Â· Cerradura solenoide Â· Sensor de presiÃ³n</span>
      </div>

      <div class="access-grid">
        <!-- Door visual -->
        <div class="door-status-card">
          <div style="font-family:var(--font-mono);font-size:0.68rem;color:var(--muted);text-transform:uppercase;margin-bottom:1rem">Estado actual</div>
          <div class="door-visual" id="doorVisual">ğŸ”</div>
          <div style="text-align:center;margin:0.5rem 0;font-family:var(--font-mono);font-size:0.8rem">
            Estado caja: <span id="lockStatus" style="color:var(--text);font-weight:700">ğŸ”’ CERRADA</span>
          </div>
          <div class="sensor-grid">
            <div class="sensor-chip">
              <div class="sensor-chip-icon">âš–ï¸</div>
              <div><div class="sensor-chip-val" id="sensorTapete">0 kg</div><div class="sensor-chip-lbl">Tapete</div></div>
            </div>
            <div class="sensor-chip">
              <div class="sensor-chip-icon">ğŸ“¦</div>
              <div><div class="sensor-chip-val" id="sensorCaja">VacÃ­a</div><div class="sensor-chip-lbl">Caja</div></div>
            </div>
            <div class="sensor-chip">
              <div class="sensor-chip-icon">ğŸ“·</div>
              <div><div class="sensor-chip-val" id="camStatus">â€“</div><div class="sensor-chip-lbl">CÃ¡mara</div></div>
            </div>
            <div class="sensor-chip">
              <div class="sensor-chip-icon">â±ï¸</div>
              <div><div class="sensor-chip-val" id="boxOpenSecs" style="color:var(--warn)">â€“</div><div class="sensor-chip-lbl">Caja abierta</div></div>
            </div>
          </div>
          <div class="box-timer" id="boxTimerWrap">
            <span style="font-family:var(--font-mono);font-size:0.75rem;color:var(--warn)">â±ï¸ Caja abierta hace</span>
            <div class="box-timer-val" id="boxTimerVal">0s</div>
          </div>
        </div>

        <!-- Controls -->
        <div>
          <div style="font-family:var(--font-mono);font-size:0.68rem;color:var(--muted);text-transform:uppercase;margin-bottom:1rem">Controles</div>
          <div class="access-controls">
            <button class="btn-access cam"    onclick="triggerCamera()">ğŸ“· Tomar Foto / Ver CÃ¡mara</button>
            <button class="btn-access unlock" onclick="unlockBox()">ğŸ”“ Abrir Caja de Seguridad</button>
            <button class="btn-access lock"   onclick="lockBox()">ğŸ”’ Cerrar y Asegurar Caja</button>
          </div>
          <div style="margin-top:1.5rem">
            <div style="font-family:var(--font-mono);font-size:0.68rem;color:var(--muted);text-transform:uppercase;margin-bottom:0.8rem">LÃ³gica automÃ¡tica</div>
            <div style="font-family:var(--font-mono);font-size:0.72rem;color:var(--muted);line-height:1.8">
              â±ï¸ Caja abierta &gt;2min â†’ <span style="color:var(--warn)">Alarma activada</span><br>
              â±ï¸ Caja abierta &gt;2:30min â†’ <span style="color:var(--danger)">Cierre automÃ¡tico</span><br>
              ğŸ“³ VibraciÃ³n puerta â†’ <span style="color:var(--access)">Foto + notificaciÃ³n</span><br>
              ğŸ“¦ Peso en caja â†’ <span style="color:var(--access)">Paquete confirmado</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Event log -->
      <div class="access-log-card">
        <div class="log-header">// REGISTRO DE ACCESOS</div>
        <div class="log-scroll" id="log-access"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â• PANEL 3: ENERGÃA â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="sys-panel" id="panel-energy">
      <div class="sys-header energy">
        <span class="sys-header-icon">âš¡</span>
        <span class="sys-header-title">EnergÃ­a Hogar</span>
        <span class="sys-header-sub">â€” Sensor corriente ACS712 Â· Gas MQ-2 Â· Relevadores por sector</span>
      </div>

      <!-- Travel mode -->
      <div class="travel-mode-bar">
        <span class="travel-label">Modo Viaje:</span>
        <div class="travel-toggle">
          <label class="toggle-switch" onclick="toggleTravelMode()">
            <input type="checkbox" id="travelCheckbox">
            <div class="toggle-track"></div>
            <div class="toggle-thumb"></div>
          </label>
          <span class="travel-status" id="travelStatus">Modo viaje desactivado</span>
        </div>
        <div style="margin-left:auto;font-family:var(--font-mono);font-size:0.72rem;color:var(--muted)">
          Activar cuando salgas de casa para monitorear consumos inusuales
        </div>
      </div>

      <!-- Gas sensor -->
      <div class="gas-card" id="gasCard">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:0.5rem">
          <div style="font-family:var(--font-mono);font-size:0.7rem;color:var(--muted);text-transform:uppercase">ğŸ’¨ SENSOR GAS MQ-2</div>
          <div style="display:flex;gap:0.6rem">
            <button class="btn-valve open"  onclick="setGasValve(true)">ğŸŸ¢ Abrir VÃ¡lvula</button>
            <button class="btn-valve close" onclick="setGasValve(false)">ğŸ”´ Cerrar VÃ¡lvula</button>
          </div>
        </div>
        <div class="gas-reading">
          <div class="gas-val" id="gasLevel">â€“</div>
          <div class="gas-unit">ppm</div>
          <div style="margin-left:1rem;font-family:var(--font-mono);font-size:0.75rem">
            VÃ¡lvula: <span id="valveStatus" style="font-weight:700">â€“</span>
          </div>
        </div>
        <div class="gas-bar"><div class="gas-fill" id="gasFill" style="width:12%;background:var(--access)"></div></div>
        <div style="font-family:var(--font-mono);font-size:0.7rem;color:var(--muted)">
          <span style="color:var(--access)">&lt;25ppm Normal</span> Â· <span style="color:var(--warn)">25-50ppm Advertencia</span> Â· <span style="color:var(--danger)">&gt;50ppm CRÃTICO â†’ VÃ¡lvula cierra automÃ¡ticamente</span>
        </div>
      </div>

      <!-- Sector cards -->
      <div class="energy-grid">
        <!-- General -->
        <div class="sector-card">
          <div class="sector-header">
            <div class="sector-title">âš¡ Consumo General</div>
            <span class="badge normal" id="generalStatus">NORMAL</span>
          </div>
          <div class="sector-body">
            <div class="watt-display normal" id="totalWatts">â€“</div>
            <div class="watt-label">WATTS TOTALES</div>
            <div class="power-bar"><div class="power-fill" id="powerFill" style="width:20%;background:var(--access)"></div></div>
          </div>
        </div>
        <!-- Sala -->
        <div class="sector-card">
          <div class="sector-header">
            <div class="sector-title">ğŸ›‹ï¸ Sala</div>
          </div>
          <div class="sector-body">
            <div class="watt-display normal" id="salaWatts">â€“</div>
            <div class="watt-label">WATTS â€” SALA</div>
            <div class="power-bar"><div class="power-fill" id="salaPowerFill" style="width:30%;background:var(--access)"></div></div>
            <div class="relay-controls">
              <button class="btn-relay on"  onclick="setRelay('sala',true)">ğŸŸ¢ Encender</button>
              <button class="btn-relay off" onclick="setRelay('sala',false)">ğŸ”Œ Cortar</button>
            </div>
          </div>
        </div>
        <!-- Cocina -->
        <div class="sector-card">
          <div class="sector-header">
            <div class="sector-title">ğŸ³ Cocina</div>
          </div>
          <div class="sector-body">
            <div class="watt-display normal" id="cocinaWatts">â€“</div>
            <div class="watt-label">WATTS â€” COCINA</div>
            <div class="power-bar"><div class="power-fill" id="cocinaPowerFill" style="width:20%;background:var(--access)"></div></div>
            <div class="relay-controls">
              <button class="btn-relay on"  onclick="setRelay('cocina',true)">ğŸŸ¢ Encender</button>
              <button class="btn-relay off" onclick="setRelay('cocina',false)">ğŸ”Œ Cortar</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Log -->
      <div class="action-log">
        <div class="log-title">// LOG ENERGÃA</div>
        <div class="log-entries" id="log-energy"></div>
      </div>
    </div>

  </main>

  <footer class="site-footer">
    <span>Â© 2026 NEXUSÂ·IOT Smart Home</span><span class="footer-sep">|</span>
    <span>TecnologÃ­as IoT</span><span class="footer-sep">|</span>
    <span>DiseÃ±ado por Daniel Flores Bautista</span>
    <a class="footer-link" href="https://www.linkedin.com/in/daniel-flores-bautista-71762227b/" target="_blank" rel="noopener"><i class="linkedin-icon">in</i></a>
  </footer>
  <div class="toast-container" id="toastContainer"></div>
</div>
<script src="js/control.js"></script>
</body>
</html>
